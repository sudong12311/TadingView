<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alert Setup</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* 다크 모드 테마 색상 정의 */
        :root {
            --bg-color: #131722;
            --text-primary: #d1d4dc;
            --text-secondary: #787b86;
            --input-bg: #2a2e39;
            --border-color: #363a45;
            --primary-blue: #2962ff;
            --btn-hover: #1e53e5;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 16px;
            box-sizing: border-box;
        }

        h3 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 500;
        }

        /* 공통 스타일 */
        .row-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .flex-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .flex-col {
            flex: 1;
        }
        
        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 14px;
            box-sizing: border-box;
            outline: none;
            appearance: none; /* 기본 스타일 제거 */
        }
        select:focus, input:focus {
            border-color: var(--primary-blue);
        }
        /* 셀렉트박스 화살표 커스텀 */
        select {
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23d1d4dc%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.8-9.2-5.4-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 12px top 50%;
            background-size: 10px auto;
            padding-right: 30px;
        }

        /* 작은 버튼 스타일 */
        .btn-small {
            padding: 10px 12px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            cursor: pointer;
            white-space: nowrap;
        }
        .btn-small:active { background-color: var(--border-color); }
        .btn-add { color: var(--primary-blue); }
        .btn-remove { color: #f23645; } /* 트레이딩뷰 빨간색 */

        /* 인풋 옆 라벨 스타일 */
        .inline-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-right: 8px;
            white-space: nowrap;
        }
        
        /* 체크박스 (토글 스위치 스타일) */
        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 22px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            transition: .4s;
            border-radius: 22px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 2px;
            background-color: var(--text-secondary);
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }
        input:checked + .slider:before {
            transform: translateX(18px);
            background-color: white;
        }

        /* 하단 저장 버튼 */
        .btn-save {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
        }
        .btn-save:active { background-color: var(--btn-hover); }
    </style>
</head>
<body>
    <h3>알림 설정</h3>

    <div class="form-group">
        <label class="row-label">종목</label>
        <div class="flex-row">
            <select class="flex-col" id="symbol_select">
                <option value="BTC/KRW">BTC/KRW</option>
                <option value="ETH/KRW">ETH/KRW</option>
                <option value="XRP/KRW">XRP/KRW</option>
            </select>
            <button class="btn-small btn-add">추가</button>
        </div>
        <div class="flex-row" style="margin-top: 8px;">
            <select class="flex-col" id="favorite_symbol_select">
                <option value="">관심종목 선택</option>
                <option value="BTC/KRW">BTC/KRW</option>
            </select>
            <button class="btn-small btn-remove">제거</button>
        </div>
    </div>

    <div class="form-group">
        <label class="row-label">거래소</label>
        <div class="flex-row">
            <select class="flex-col" id="exchange_select">
                <option value="upbit">업비트</option>
                <option value="binance">바이낸스</option>
            </select>
            <button class="btn-small btn-add">추가</button>
        </div>
        <div class="flex-row" style="margin-top: 8px;">
            <select class="flex-col" id="configured_exchange_select">
                <option value="">설정된 거래소 선택</option>
                <option value="upbit">업비트</option>
            </select>
            <button class="btn-small btn-remove">제거</button>
        </div>
    </div>

    <div class="form-group">
        <label class="row-label">BB1</label>
        <div class="flex-row">
            <div class="flex-row flex-col">
                <span class="inline-label">기간</span>
                <input type="number" id="bb1_period" value="20">
            </div>
            <div class="flex-row flex-col">
                <span class="inline-label">승수</span>
                <input type="number" id="bb1_multiplier" value="2">
            </div>
        </div>
    </div>

    <div class="form-group">
        <label class="row-label">BB2</label>
        <div class="flex-row">
            <div class="flex-row flex-col">
                <span class="inline-label">기간</span>
                <input type="number" id="bb2_period" value="20">
            </div>
            <div class="flex-row flex-col">
                <span class="inline-label">승수</span>
                <input type="number" id="bb2_multiplier" value="3">
            </div>
        </div>
    </div>

    <div class="form-group">
        <label class="row-label">매수범위</label>
        <div class="flex-row">
            <input type="number" id="buy_start" class="flex-col" placeholder="시작가">
            <span class="inline-label" style="margin: 0 8px;">에서</span>
            <input type="number" id="buy_end" class="flex-col" placeholder="종료가">
            <span class="inline-label" style="margin-left: 8px;">까지</span>
        </div>
    </div>

    <div class="form-group flex-row" style="justify-content: space-between;">
        <label class="row-label" style="margin-bottom: 0;">알림 사용</label>
        <label class="switch">
            <input type="checkbox" id="alert_enabled" checked>
            <span class="slider"></span>
        </label>
    </div>

    <button class="btn-save" onclick="sendData()">저장하기</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // 추가/제거 버튼에 대한 동작은 실제 구현 시 자바스크립트로 추가해야 합니다.
        // 현재는 UI만 구현되어 있습니다.

        function sendData() {
            // 입력된 모든 데이터 수집
            const data = {
                action: "save_config",
                symbol: document.getElementById('symbol_select').value,
                favorite_symbol: document.getElementById('favorite_symbol_select').value,
                exchange: document.getElementById('exchange_select').value,
                configured_exchange: document.getElementById('configured_exchange_select').value,
                bb1: {
                    period: parseInt(document.getElementById('bb1_period').value) || 0,
                    multiplier: parseFloat(document.getElementById('bb1_multiplier').value) || 0
                },
                bb2: {
                    period: parseInt(document.getElementById('bb2_period').value) || 0,
                    multiplier: parseFloat(document.getElementById('bb2_multiplier').value) || 0
                },
                buy_range: {
                    start: parseFloat(document.getElementById('buy_start').value) || 0,
                    end: parseFloat(document.getElementById('buy_end').value) || 0
                },
                alert_enabled: document.getElementById('alert_enabled').checked
            };

            // 봇으로 데이터 전송
            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>
</html>
